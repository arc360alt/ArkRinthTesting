name: Build ArkRinth Flatpak

on:
  push:
    branches: [ main ]
  release:
    types: [ published ]

jobs:
  build-flatpak:
    runs-on: ubuntu-latest
    container:
      image: bilelmoussaoui/flatpak-github-actions:freedesktop-22.08
      options: --privileged

    steps:
    - uses: actions/checkout@v4

    - name: Build Flatpak
      uses: bilelmoussaoui/flatpak-github-actions/flatpak-builder@v6
      with:
        bundle: true
        manifest-path: org.arkrinth.ArkRinth.yml
        cache-key: flatpak-builder-${{ github.sha }}

    - name: Upload Flatpak
      uses: actions/upload-artifact@v4
      with:
        name: arkrith-flatpak
        path: "*.flatpak"
